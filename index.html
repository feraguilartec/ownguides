<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Experiencia con Gaze y Pinch</title>
    <!-- A-Frame Library -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- A-Frame WebXR Hand Tracking -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-xr-hand-tracking@1.2.0/dist/aframe-xr-hand-tracking.min.js"></script>
    <!-- Gaze Pinch Movement -->
    <script>
      AFRAME.registerComponent('gaze-pinch-move', {
        schema: { default: '' },
        init: function () {
          const el = this.el;
          const sceneEl = el.sceneEl;
          const cameraEl = sceneEl.querySelector('[camera]');
          let isPinching = false;

          // Detect pinch start
          sceneEl.addEventListener('pinchstarted', (evt) => {
            if (evt.detail.intersectedEl === el) {
              isPinching = true;
              el.setAttribute('material', 'color', '#FF5722'); // Highlight on pinch
            }
          });

          // Detect pinch end
          sceneEl.addEventListener('pinchended', () => {
            isPinching = false;
            el.setAttribute('material', 'color', '#4CC3D9'); // Revert color
          });

          // Move object if pinching and gazing
          this.tick = function () {
            if (isPinching) {
              const cameraWorldPosition = new THREE.Vector3();
              const gazeDirection = new THREE.Vector3();

              // Get camera position and gaze direction
              cameraEl.object3D.getWorldPosition(cameraWorldPosition);
              cameraEl.object3D.getWorldDirection(gazeDirection);

              // Move the object along the gaze direction
              const newPosition = cameraWorldPosition.clone().add(gazeDirection.multiplyScalar(2)); // Adjust distance
              el.object3D.position.lerp(newPosition, 0.2); // Smooth movement
            }
          };
        },
      });
    </script>
  </head>
  <body>
    <a-scene
      vr-mode-ui="enabled: true"
      xrweb="allowedFeatures: [ 'hand-tracking', 'eye-tracking' ]"
    >
      <!-- Entorno -->
      <a-sky color="#ECECEC"></a-sky>

      <!-- Esfera interactiva -->
      <a-sphere
        id="interactive-sphere"
        position="0 1.25 -1"
        radius="0.5"
        color="#4CC3D9"
        class="interactive"
        gaze-pinch-move
      ></a-sphere>

      <!-- Controladores para manos -->
      <a-entity
        id="left-hand"
        hand-tracking-controls="hand: left"
        xr-hand-tracking
        hand-model
        position="0 1 -1.5"
      ></a-entity>
      <a-entity
        id="right-hand"
        hand-tracking-controls="hand: right"
        xr-hand-tracking
        hand-model
        position="0 1 -1.5"
      ></a-entity>

      <!-- CÃ¡mara con Gaze Tracking -->
      <a-camera
        position="0 1.6 0"
        look-controls="enabled: true"
        id="gaze-camera"
      >
        <a-entity
          id="cursor"
          cursor="rayOrigin: mouse"
          geometry="primitive: ring; radiusOuter: 0.02; radiusInner: 0.01"
          material="color: black; shader: flat"
        ></a-entity>
      </a-camera>
    </a-scene>
  </body>
</html>
