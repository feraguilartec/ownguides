<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interacción con Caja en A-Frame</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene cursor="rayOrigin: mouse" raycaster="objects: .draggable">
        <!-- Componente para arrastrar y soltar la caja -->
        <script>
            AFRAME.registerComponent('draggable', {
                schema: {
                    isDragging: {default: false},
                    offset: {type: 'vec3'}
                },
                
                init: function () {
                    this.handleMouseDown = this.handleMouseDown.bind(this);
                    this.handleMouseUp = this.handleMouseUp.bind(this);
                    this.handleMouseMove = this.handleMouseMove.bind(this);

                    this.el.addEventListener('mousedown', this.handleMouseDown);
                    window.addEventListener('mouseup', this.handleMouseUp);
                    window.addEventListener('mousemove', this.handleMouseMove);
                },

                handleMouseDown: function (evt) {
                    this.data.isDragging = true;
                    const intersection = evt.detail.intersection;
                    if (intersection) {
                        const point = intersection.point;
                        const elPosition = this.el.object3D.position;
                        this.data.offset = {
                            x: point.x - elPosition.x,
                            y: point.y - elPosition.y,
                            z: point.z - elPosition.z
                        };
                    }
                },

                handleMouseMove: function (evt) {
                    if (!this.data.isDragging) return;
                    
                    const raycaster = this.el.sceneEl.components.raycaster;
                    const intersection = raycaster.getIntersection(this.el);

                    if (intersection) {
                        const point = intersection.point;
                        const offset = this.data.offset;
                        this.el.object3D.position.set(
                            point.x - offset.x,
                            point.y - offset.y,
                            point.z - offset.z
                        );
                    }
                },

                handleMouseUp: function () {
                    this.data.isDragging = false;
                }
            });
        </script>

        <!-- Caja interactiva -->
        <a-box position="0 1.5 -3" color="tomato" width="1" height="1" depth="1" class="draggable" draggable></a-box>
        
        <!-- Entorno básico -->
        <a-sky color="#ECECEC"></a-sky>
        <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>
    </a-scene>
</body>
</html>
